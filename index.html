import React, { useState, useEffect, useRef } from 'react';

const SENTENCES = [
  "The quick brown fox jumps over the lazy dog near the riverbank.",
  "She sells seashells by the seashore while watching the sunset.",
  "A journey of a thousand miles begins with a single step forward.",
  "Life is what happens when you're busy making other plans.",
  "The early bird catches the worm but the second mouse gets the cheese.",
  "Practice makes perfect but nobody's perfect so why practice at all?",
  "Time flies like an arrow but fruit flies like a banana instead.",
  "To be or not to be, that is the question we must answer.",
  "All that glitters is not gold, and not all who wander are lost.",
  "The pen is mightier than the sword in the hands of a writer.",
  "Knowledge is power but enthusiasm pulls the switch that turns it on.",
  "Success is not final and failure is not fatal, courage continues on.",
  "The only way to do great work is to love what you do.",
  "In the middle of difficulty lies opportunity waiting to be found.",
  "The future belongs to those who believe in the beauty of their dreams.",
  "Yesterday is history, tomorrow is a mystery, but today is a gift.",
  "Happiness is not something ready made, it comes from your own actions.",
  "The best time to plant a tree was twenty years ago.",
  "Change your thoughts and you change your world for the better.",
  "The greatest glory in living lies not in never falling but rising.",
];

export default function TypingTest() {
  const [mode, setMode] = useState('menu'); // menu, typing, clicking
  const [currentSentence, setCurrentSentence] = useState('');
  const [userInput, setUserInput] = useState('');
  const [startTime, setStartTime] = useState(null);
  const [isActive, setIsActive] = useState(false);
  const [isFinished, setIsFinished] = useState(false);
  const [wpm, setWpm] = useState(0);
  const [accuracy, setAccuracy] = useState(100);
  const [errors, setErrors] = useState(0);
  
  // Click test states
  const [clicks, setClicks] = useState(0);
  const [clickTimeLeft, setClickTimeLeft] = useState(15);
  const [clickTestActive, setClickTestActive] = useState(false);
  const [clickTestFinished, setClickTestFinished] = useState(false);
  const [cps, setCps] = useState(0);
  
  const inputRef = useRef(null);

  useEffect(() => {
    if (mode === 'typing') {
      getNewSentence();
      inputRef.current?.focus();
    }
  }, [mode]);

  useEffect(() => {
    if (clickTestActive && clickTimeLeft > 0) {
      const timer = setTimeout(() => setClickTimeLeft(clickTimeLeft - 1), 1000);
      return () => clearTimeout(timer);
    } else if (clickTimeLeft === 0 && clickTestActive) {
      finishClickTest();
    }
  }, [clickTimeLeft, clickTestActive]);

  const getNewSentence = () => {
    const randomSentence = SENTENCES[Math.floor(Math.random() * SENTENCES.length)];
    setCurrentSentence(randomSentence);
  };

  const handleInput = (e) => {
    const value = e.target.value;

    if (!isActive && value.length > 0) {
      setIsActive(true);
      setStartTime(Date.now());
    }

    setUserInput(value);

    if (value === currentSentence) {
      finishTypingTest();
    }
  };

  const finishTypingTest = () => {
    setIsActive(false);
    setIsFinished(true);

    const timeInMinutes = (Date.now() - startTime) / 1000 / 60;
    const wordsTyped = currentSentence.split(' ').length;
    const calculatedWpm = Math.round(wordsTyped / timeInMinutes);

    let errorCount = 0;
    for (let i = 0; i < userInput.length; i++) {
      if (userInput[i] !== currentSentence[i]) {
        errorCount++;
      }
    }

    const calculatedAccuracy = Math.round(((currentSentence.length - errorCount) / currentSentence.length) * 100);

    setWpm(calculatedWpm);
    setAccuracy(calculatedAccuracy);
    setErrors(errorCount);
  };

  const restartTyping = () => {
    setUserInput('');
    setStartTime(null);
    setIsActive(false);
    setIsFinished(false);
    setWpm(0);
    setAccuracy(100);
    setErrors(0);
    getNewSentence();
    inputRef.current?.focus();
  };

  const getCharStatus = (index) => {
    if (index >= userInput.length) return 'text-gray-500';
    if (userInput[index] === currentSentence[index]) return 'text-green-400';
    return 'text-red-500 bg-red-900/20';
  };

  // Click test functions
  const startClickTest = () => {
    setClickTestActive(true);
    setClicks(0);
    setClickTimeLeft(15);
    setClickTestFinished(false);
  };

  const handleClick = () => {
    if (clickTestActive) {
      setClicks(clicks + 1);
    }
  };

  const finishClickTest = () => {
    setClickTestActive(false);
    setClickTestFinished(true);
    setCps((clicks / 15).toFixed(2));
  };

  const restartClickTest = () => {
    setClicks(0);
    setClickTimeLeft(15);
    setClickTestActive(false);
    setClickTestFinished(false);
    setCps(0);
  };

  const backToMenu = () => {
    setMode('menu');
    restartTyping();
    restartClickTest();
  };

  if (mode === 'menu') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-purple-900 via-gray-900 to-indigo-900 text-white flex flex-col">
        <div className="flex-1 flex items-center justify-center p-8">
          <div className="max-w-4xl w-full">
            <div className="text-center mb-8">
              <a 
                href="https://ltnproject.github.io/dashboard/" 
                className="inline-flex items-center gap-2 px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-xl transition-colors font-semibold mb-6"
              >
                üîô To Dashboard
              </a>
              <h1 className="text-7xl font-bold mb-4 bg-gradient-to-r from-purple-400 via-pink-400 to-indigo-400 bg-clip-text text-transparent">
                Type Master Pro
              </h1>
              <p className="text-gray-400 text-xl">Choose your challenge</p>
            </div>

            <div className="grid md:grid-cols-2 gap-6 mb-8">
              {/* Typing Test Card */}
              <div 
                onClick={() => setMode('typing')}
                className="bg-gray-800/50 backdrop-blur-lg rounded-3xl p-8 border-2 border-purple-500/30 hover:border-purple-500/60 transition-all cursor-pointer transform hover:scale-105 shadow-2xl"
              >
                <div className="text-6xl mb-4">‚å®Ô∏è</div>
                <h2 className="text-3xl font-bold mb-3 text-purple-300">Typing Speed Test</h2>
                <p className="text-gray-400 mb-4">Type complete sentences and measure your WPM, accuracy, and errors</p>
                <div className="flex flex-wrap gap-2">
                  <span className="px-3 py-1 bg-purple-500/20 rounded-full text-sm">Speed (WPM)</span>
                  <span className="px-3 py-1 bg-blue-500/20 rounded-full text-sm">Accuracy</span>
                  <span className="px-3 py-1 bg-pink-500/20 rounded-full text-sm">Error Count</span>
                </div>
              </div>

              {/* Click Speed Card */}
              <div 
                onClick={() => setMode('clicking')}
                className="bg-gray-800/50 backdrop-blur-lg rounded-3xl p-8 border-2 border-pink-500/30 hover:border-pink-500/60 transition-all cursor-pointer transform hover:scale-105 shadow-2xl"
              >
                <div className="text-6xl mb-4">üñ±Ô∏è</div>
                <h2 className="text-3xl font-bold mb-3 text-pink-300">Click Speed Test</h2>
                <p className="text-gray-400 mb-4">Test how many clicks you can do in 15 seconds</p>
                <div className="flex flex-wrap gap-2">
                  <span className="px-3 py-1 bg-pink-500/20 rounded-full text-sm">15 Seconds</span>
                  <span className="px-3 py-1 bg-red-500/20 rounded-full text-sm">Click Counter</span>
                  <span className="px-3 py-1 bg-orange-500/20 rounded-full text-sm">CPS Rate</span>
                </div>
              </div>
            </div>

            {/* Stats Info */}
            <div className="bg-gray-800/30 backdrop-blur-lg rounded-2xl p-6 border border-purple-500/20">
              <h3 className="text-xl font-bold mb-4 text-purple-300">üìä What You'll Learn</h3>
              <div className="grid md:grid-cols-2 gap-4 text-sm">
                <div>
                  <span className="font-semibold text-green-400">Typing Test:</span>
                  <ul className="ml-4 mt-2 text-gray-400 space-y-1">
                    <li>‚Ä¢ Words Per Minute (WPM)</li>
                    <li>‚Ä¢ Typing accuracy percentage</li>
                    <li>‚Ä¢ Number of errors made</li>
                    <li>‚Ä¢ Real-time progress tracking</li>
                  </ul>
                </div>
                <div>
                  <span className="font-semibold text-pink-400">Click Test:</span>
                  <ul className="ml-4 mt-2 text-gray-400 space-y-1">
                    <li>‚Ä¢ Total clicks in 15 seconds</li>
                    <li>‚Ä¢ Clicks Per Second (CPS)</li>
                    <li>‚Ä¢ Mouse speed ranking</li>
                    <li>‚Ä¢ Beat your high score</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* Footer */}
        <footer className="bg-gray-900/50 backdrop-blur-lg border-t border-purple-500/20 py-6">
          <div className="max-w-6xl mx-auto px-8">
            <div className="flex flex-col md:flex-row justify-between items-center gap-4">
              <div className="text-center md:text-left">
                <h3 className="text-xl font-bold text-purple-300 mb-2">Ltn Project Dashboard</h3>
                <p className="text-gray-400 text-sm">¬© 2025 Ltn Project by Jacob</p>
              </div>
              
              <div className="flex flex-col md:flex-row gap-6 text-sm">
                <div>
                  <p className="text-gray-400 mb-1">üìû <span className="font-semibold text-purple-300">Contact Us:</span></p>
                  <p className="text-gray-300">Gmail: ltnprojectbyjacob@gmail.com</p>
                  <p className="text-gray-300">L-Connect: ltnprojectbyjacob@gmail.com</p>
                </div>
                <div>
                  <p className="text-gray-400 mb-1">‚ñ∂Ô∏è <span className="font-semibold text-pink-300">YouTube:</span></p>
                  <a 
                    href="https://www.youtube.com/@LtnRBLX" 
                    target="_blank" 
                    rel="noopener noreferrer"
                    className="text-blue-400 hover:text-blue-300 underline"
                  >
                    www.youtube.com/@LtnRBLX
                  </a>
                </div>
              </div>
            </div>
          </div>
        </footer>
      </div>
    );
  }

  if (mode === 'clicking') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-pink-900 via-gray-900 to-red-900 text-white flex flex-col">
        <div className="flex-1 flex items-center justify-center p-8">
          <div className="max-w-4xl w-full">
            <div className="text-center mb-12">
              <h1 className="text-6xl font-bold mb-3 bg-gradient-to-r from-pink-400 via-red-400 to-orange-400 bg-clip-text text-transparent">
                Click Speed Test üñ±Ô∏è
              </h1>
              <p className="text-gray-400 text-lg">How fast can you click?</p>
            </div>

            {!clickTestActive && !clickTestFinished && (
              <div className="text-center">
                <button
                  onClick={startClickTest}
                  className="px-12 py-6 bg-gradient-to-r from-pink-500 to-red-500 hover:from-pink-600 hover:to-red-600 rounded-2xl font-bold text-2xl transition-all transform hover:scale-110 shadow-2xl"
                >
                  Start Click Test
                </button>
                <p className="text-gray-400 mt-6">Click the button as fast as you can for 15 seconds!</p>
              </div>
            )}

            {clickTestActive && (
              <div className="bg-gray-800/50 backdrop-blur-lg rounded-3xl p-12 border-2 border-pink-500/30 shadow-2xl text-center">
                <div className="text-8xl font-bold text-pink-400 mb-6">{clickTimeLeft}</div>
                <div className="text-2xl text-gray-400 mb-8">seconds left</div>
                
                <button
                  onClick={handleClick}
                  className="w-64 h-64 bg-gradient-to-br from-pink-500 to-red-500 hover:from-pink-600 hover:to-red-600 rounded-full font-bold text-4xl transition-all transform hover:scale-95 active:scale-90 shadow-2xl mx-auto flex items-center justify-center"
                >
                  CLICK!
                </button>
                
                <div className="text-6xl font-bold text-white mt-8">{clicks}</div>
                <div className="text-gray-400 mt-2">clicks</div>
              </div>
            )}

            {clickTestFinished && (
              <div className="bg-gray-800/50 backdrop-blur-lg rounded-3xl p-10 border-2 border-pink-500/30 shadow-2xl">
                <h2 className="text-3xl font-bold text-center mb-8 text-pink-300">Test Complete! üéâ</h2>
                <div className="grid grid-cols-2 gap-8 mb-8">
                  <div className="text-center">
                    <div className="text-gray-400 text-sm uppercase tracking-wider mb-2">Total Clicks</div>
                    <div className="text-7xl font-bold bg-gradient-to-r from-pink-400 to-red-400 bg-clip-text text-transparent">
                      {clicks}
                    </div>
                  </div>
                  <div className="text-center">
                    <div className="text-gray-400 text-sm uppercase tracking-wider mb-2">Clicks Per Second</div>
                    <div className="text-7xl font-bold bg-gradient-to-r from-orange-400 to-yellow-400 bg-clip-text text-transparent">
                      {cps}
                    </div>
                  </div>
                </div>
                
                <div className="bg-gray-900/50 rounded-xl p-4 mb-6">
                  <p className="text-center text-lg font-bold">
                    {clicks < 30 ? 'üêå Beginner - Keep practicing!' : 
                     clicks < 50 ? 'üòä Decent - Not bad!' : 
                     clicks < 70 ? 'üëç Good - Nice work!' : 
                     clicks < 90 ? 'üî• Great - Impressive!' : 
                     clicks < 110 ? '‚ö° Excellent - Amazing!' : 
                     'üèÜ LEGENDARY - You\'re a beast!'}
                  </p>
                  <p className="text-center text-sm text-gray-400 mt-2">
                    {clicks < 30 ? 'Try using multiple fingers!' : 
                     clicks < 50 ? 'You\'re getting there!' : 
                     clicks < 70 ? 'Above average performance!' : 
                     clicks < 90 ? 'You\'re really fast!' : 
                     clicks < 110 ? 'Professional level!' : 
                     'Are you even human?!'}
                  </p>
                </div>

                <button
                  onClick={restartClickTest}
                  className="w-full py-4 bg-gradient-to-r from-pink-500 to-red-500 hover:from-pink-600 hover:to-red-600 rounded-xl font-bold text-lg transition-all transform hover:scale-105 shadow-lg"
                >
                  Try Again
                </button>
              </div>
            )}

            <div className="text-center mt-8">
              <button
                onClick={backToMenu}
                className="px-8 py-3 bg-gray-700 hover:bg-gray-600 rounded-xl transition-colors font-semibold"
              >
                üîô Back to Menu
              </button>
            </div>
          </div>
        </div>

        <footer className="bg-gray-900/50 backdrop-blur-lg border-t border-pink-500/20 py-6">
          <div className="max-w-6xl mx-auto px-8">
            <div className="flex flex-col md:flex-row justify-between items-center gap-4">
              <div className="text-center md:text-left">
                <h3 className="text-xl font-bold text-pink-300 mb-2">Ltn Project Dashboard</h3>
                <p className="text-gray-400 text-sm">¬© 2025 Ltn Project by Jacob</p>
              </div>
              
              <div className="flex flex-col md:flex-row gap-6 text-sm">
                <div>
                  <p className="text-gray-400 mb-1">üìû <span className="font-semibold text-pink-300">Contact Us:</span></p>
                  <p className="text-gray-300">Gmail: ltnprojectbyjacob@gmail.com</p>
                  <p className="text-gray-300">L-Connect: ltnprojectbyjacob@gmail.com</p>
                </div>
                <div>
                  <p className="text-gray-400 mb-1">‚ñ∂Ô∏è <span className="font-semibold text-pink-300">YouTube:</span></p>
                  <a 
                    href="https://www.youtube.com/@LtnRBLX" 
                    target="_blank" 
                    rel="noopener noreferrer"
                    className="text-blue-400 hover:text-blue-300 underline"
                  >
                    www.youtube.com/@LtnRBLX
                  </a>
                </div>
              </div>
            </div>
          </div>
        </footer>
      </div>
    );
  }

  // Typing test mode
  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-900 via-gray-900 to-indigo-900 text-white flex flex-col">
      <div className="flex-1 flex items-center justify-center p-8">
        <div className="max-w-4xl w-full">
          <div className="text-center mb-12">
            <h1 className="text-6xl font-bold mb-3 bg-gradient-to-r from-purple-400 via-pink-400 to-indigo-400 bg-clip-text text-transparent">
              Typing Speed Test ‚å®Ô∏è
            </h1>
            <p className="text-gray-400 text-lg">
              Words to type: <span className="text-purple-400 font-bold">{currentSentence.split(' ').length}</span>
            </p>
          </div>

          {isFinished && (
            <div className="bg-gray-800/50 backdrop-blur-lg rounded-3xl p-10 mb-8 border-2 border-purple-500/30 shadow-2xl">
              <h2 className="text-3xl font-bold text-center mb-8 text-purple-300">Test Complete! üéâ</h2>
              <div className="grid grid-cols-3 gap-8 mb-8">
                <div className="text-center">
                  <div className="text-gray-400 text-sm uppercase tracking-wider mb-2">Speed</div>
                  <div className="text-6xl font-bold bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent">
                    {wpm}
                  </div>
                  <div className="text-gray-500 text-sm mt-1">WPM</div>
                </div>
                <div className="text-center">
                  <div className="text-gray-400 text-sm uppercase tracking-wider mb-2">Accuracy</div>
                  <div className="text-6xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent">
                    {accuracy}
                  </div>
                  <div className="text-gray-500 text-sm mt-1">%</div>
                </div>
                <div className="text-center">
                  <div className="text-gray-400 text-sm uppercase tracking-wider mb-2">Errors</div>
                  <div className="text-6xl font-bold bg-gradient-to-r from-red-400 to-orange-400 bg-clip-text text-transparent">
                    {errors}
                  </div>
                  <div className="text-gray-500 text-sm mt-1">mistakes</div>
                </div>
              </div>
              
              <div className="bg-gray-900/50 rounded-xl p-4 mb-6">
                <p className="text-center text-lg font-bold">
                  {wpm < 20 ? 'üêå Beginner - Keep practicing!' : 
                   wpm < 40 ? 'üòä Average - Getting better!' : 
                   wpm < 60 ? 'üëç Good - Nice typing!' : 
                   wpm < 80 ? 'üî• Fast - Great speed!' : 
                   wpm < 100 ? '‚ö° Excellent - Very impressive!' : 
                   'üèÜ LEGENDARY - Pro typist!'}
                </p>
                <p className="text-center text-sm text-gray-400 mt-2">
                  {wpm < 20 ? 'Take your time and focus on accuracy' : 
                   wpm < 40 ? 'You\'re improving steadily!' : 
                   wpm < 60 ? 'Above average typing speed!' : 
                   wpm < 80 ? 'Professional typing level!' : 
                   wpm < 100 ? 'Elite tier performance!' : 
                   'You type faster than most people!'}
                </p>
              </div>
              <button
                onClick={restartTyping}
                className="w-full py-4 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 rounded-xl font-bold text-lg transition-all transform hover:scale-105 shadow-lg"
              >
                Try Another Sentence
              </button>
            </div>
          )}

          {!isFinished && (
            <div 
              className="bg-gray-800/50 backdrop-blur-lg rounded-3xl p-10 mb-8 border-2 border-purple-500/30 shadow-2xl min-h-[200px] flex items-center select-none"
              onCopy={(e) => e.preventDefault()}
              onCut={(e) => e.preventDefault()}
              onPaste={(e) => e.preventDefault()}
              onDragStart={(e) => e.preventDefault()}
            >
              <div className="text-4xl leading-relaxed font-medium w-full pointer-events-none">
                {currentSentence.split('').map((char, index) => (
                  <span
                    key={index}
                    className={`${getCharStatus(index)} transition-colors duration-100`}
                  >
                    {char}
                    {index === userInput.length && (
                      <span className="inline-block w-1 h-10 bg-purple-400 animate-pulse ml-0.5 align-middle" />
                    )}
                  </span>
                ))}
              </div>
            </div>
          )}

          {!isFinished && (
            <div className="mb-6">
              <textarea
                ref={inputRef}
                value={userInput}
                onChange={handleInput}
                onPaste={(e) => e.preventDefault()}
                onCopy={(e) => e.preventDefault()}
                onCut={(e) => e.preventDefault()}
                className="w-full bg-gray-800/70 backdrop-blur-lg text-2xl p-6 rounded-2xl border-2 border-purple-500/50 focus:border-purple-400 focus:outline-none resize-none h-32 text-gray-200 placeholder-gray-500 shadow-xl"
                placeholder="Start typing the sentence above..."
                autoComplete="off"
                autoCapitalize="off"
                autoCorrect="off"
                spellCheck="false"
              />
            </div>
          )}

          {isActive && (
            <div className="flex justify-center gap-8 text-center mb-6">
              <div>
                <div className="text-gray-500 text-sm">Time</div>
                <div className="text-2xl font-bold text-purple-400">
                  {Math.floor((Date.now() - startTime) / 1000)}s
                </div>
              </div>
              <div>
                <div className="text-gray-500 text-sm">Progress</div>
                <div className="text-2xl font-bold text-pink-400">
                  {Math.round((userInput.length / currentSentence.length) * 100)}%
                </div>
              </div>
            </div>
          )}

          <div className="text-center">
            <button
              onClick={backToMenu}
              className="px-8 py-3 bg-gray-700 hover:bg-gray-600 rounded-xl transition-colors font-semibold"
            >
              üîô Back to Menu
            </button>
          </div>
        </div>
      </div>

      <footer className="bg-gray-900/50 backdrop-blur-lg border-t border-purple-500/20 py-6">
        <div className="max-w-6xl mx-auto px-8">
          <div className="flex flex-col md:flex-row justify-between items-center gap-4">
            <div className="text-center md:text-left">
              <h3 className="text-xl font-bold text-purple-300 mb-2">Ltn Project Dashboard</h3>
              <p className="text-gray-400 text-sm">¬© 2025 Ltn Project by Jacob</p>
            </div>
            
            <div className="flex flex-col md:flex-row gap-6 text-sm">
              <div>
                <p className="text-gray-400 mb-1">üìû <span className="font-semibold text-purple-300">Contact Us:</span></p>
                <p className="text-gray-300">Gmail: ltnprojectbyjacob@gmail.com</p>
                <p className="text-gray-300">L-Connect: ltnprojectbyjacob@gmail.com</p>
              </div>
              <div>
                <p className="text-gray-400 mb-1">‚ñ∂Ô∏è <span className="font-semibold text-pink-300">YouTube:</span></p>
                <a 
                  href="https://www.youtube.com/@LtnRBLX" 
                  target="_blank" 
                  rel="noopener noreferrer"
                  className="text-blue-400 hover:text-blue-300 underline"
                >
                  www.youtube.com/@LtnRBLX
                </a>
              </div>
            </div>
          </div>
        </div>
      </footer>
    </div>
  );
}