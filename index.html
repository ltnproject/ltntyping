<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Type Master Pro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase (compat for CDN + onclick safety) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body class="text-white bg-black">
  <div id="app"></div>

<script>
/* ================= FIREBASE ================= */
firebase.initializeApp({
  apiKey: "AIzaSyAv__llreM9IMHGkSSd7sfLESK-C5f8dwk",
  authDomain: "ltn-project-typing.firebaseapp.com",
  projectId: "ltn-project-typing",
  storageBucket: "ltn-project-typing.firebasestorage.app",
  messagingSenderId: "577589727870",
  appId: "1:577589727870:web:86695e39cfeec8150ebe2f"
});

const db = firebase.firestore();

/* ================= DATA ================= */
const SENTENCES = [
  "The quick brown fox jumps over the lazy dog near the riverbank.",
  "She sells seashells by the seashore while watching the sunset.",
  "A journey of a thousand miles begins with a single step forward.",
  "Life is what happens when you're busy making other plans.",
  "The early bird catches the worm but the second mouse gets the cheese.",
  "Practice makes perfect but nobody's perfect so why practice at all.",
  "Time flies like an arrow but fruit flies like a banana.",
  "To be or not to be that is the question we must answer.",
  "All that glitters is not gold and not all who wander are lost.",
  "The pen is mightier than the sword in the hands of a writer."
];

/* ================= STATE ================= */
let mode = "menu";
let currentSentence = "";
let userInput = "";
let startTime = null;
let isFinished = false;
let wpm = 0;
let accuracy = 100;
let errors = 0;

/* ================= LOGIC ================= */
function randomSentence() {
  currentSentence = SENTENCES[Math.floor(Math.random() * SENTENCES.length)];
}

function backToMenu() {
  mode = "menu";
  render();
}

function handleTyping(e) {
  if (!startTime) startTime = Date.now();
  userInput = e.target.value;
  if (userInput === currentSentence) finishTyping();
  render();
}

function finishTyping() {
  isFinished = true;
  const timeMin = (Date.now() - startTime) / 60000;
  const words = currentSentence.split(" ").length;
  wpm = Math.round(words / timeMin);

  errors = 0;
  for (let i = 0; i < userInput.length; i++) {
    if (userInput[i] !== currentSentence[i]) errors++;
  }
  accuracy = Math.round(((currentSentence.length - errors) / currentSentence.length) * 100);
}

function resetTyping() {
  userInput = "";
  startTime = null;
  isFinished = false;
  wpm = 0;
  accuracy = 100;
  errors = 0;
  randomSentence();
}

/* ================= RENDER ================= */
function render() {
  const app = document.getElementById("app");

  if (mode === "menu") {
    app.innerHTML = `
      <div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-900 via-gray-900 to-indigo-900">
        <div class="text-center">
          <h1 class="text-6xl font-bold mb-6">Type Master Pro</h1>
          <button onclick="mode='typing';resetTyping();render()"
            class="px-8 py-4 bg-purple-600 rounded-xl font-bold hover:bg-purple-500">
            ‚å®Ô∏è Start Typing
          </button>
        </div>
      </div>`;
    return;
  }

  if (mode === "typing") {
    app.innerHTML = `
      <div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-900 via-gray-900 to-indigo-900 p-8">
        <div class="max-w-3xl w-full">
          <div class="bg-gray-800 p-6 rounded-xl text-2xl mb-4">
            ${currentSentence.split("").map((c,i)=>{
              let color = "text-gray-500";
              if (i < userInput.length)
                color = userInput[i] === c ? "text-green-400" : "text-red-500";
              return `<span class="${color}">${c}</span>`;
            }).join("")}
          </div>

          ${!isFinished ? `
            <textarea oninput="handleTyping(event)"
              class="w-full p-4 rounded-xl bg-gray-800 border-2 border-purple-500 text-xl"
              placeholder="Start typing...">${userInput}</textarea>
          ` : `
            <div class="bg-gray-800 p-6 rounded-xl">
              <div class="text-3xl mb-2">WPM: ${wpm}</div>
              <div class="text-xl mb-2">Accuracy: ${accuracy}%</div>
              <div class="text-xl mb-4">Errors: ${errors}</div>
              <button onclick="resetTyping();render()"
                class="w-full py-3 bg-purple-600 rounded-xl font-bold hover:bg-purple-500">
                üîÑ Try Again
              </button>
            </div>
          `}

          <button onclick="backToMenu()"
            class="mt-4 px-6 py-3 bg-gray-700 rounded-xl hover:bg-gray-600">
            üîô Back
          </button>
        </div>
      </div>`;
  }
}

/* ================= START ================= */
randomSentence();
render();
</script>
</body>
</html>
