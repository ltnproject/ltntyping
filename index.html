<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Type Master Pro - Christmas Edition üéÑ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #0a3d0a 0%, #8b0000 50%, #0a3d0a 100%);
      color: white;
      overflow-x: hidden;
      min-height: 100vh;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }

    /* Snowfall Animation */
    .snowflake {
      position: fixed;
      top: -10px;
      color: white;
      font-size: 1em;
      opacity: 0.8;
      pointer-events: none;
      animation: fall linear infinite;
      z-index: 1000;
    }

    @keyframes fall {
      to {
        transform: translateY(100vh) translateX(100px);
        opacity: 0;
      }
    }

    /* Christmas Lights */
    .lights {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 50px;
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 999;
      background: linear-gradient(180deg, rgba(0,0,0,0.3) 0%, transparent 100%);
    }

    .light {
      width: 15px;
      height: 15px;
      border-radius: 50%;
      animation: blink 1s infinite;
      box-shadow: 0 0 30px currentColor;
    }

    .light:nth-child(odd) { background: #ff0000; animation-delay: 0s; }
    .light:nth-child(even) { background: #00ff00; animation-delay: 0.5s; }

    @keyframes blink {
      0%, 100% { opacity: 1; box-shadow: 0 0 40px currentColor; transform: scale(1); }
      50% { opacity: 0.4; box-shadow: 0 0 10px currentColor; transform: scale(0.8); }
    }

    /* Container */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      position: relative;
      z-index: 1;
    }

    /* Menu Cards */
    .menu-container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
    }

    .title {
      font-size: 4rem;
      font-weight: bold;
      text-align: center;
      margin-bottom: 60px;
      text-shadow: 0 0 30px rgba(255, 0, 0, 0.8);
      background: linear-gradient(45deg, #ff0000, #00ff00, #ffd700, #ff0000);
      background-size: 200% 200%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: christmasGlow 3s ease infinite;
    }

    @keyframes christmasGlow {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 30px;
      width: 100%;
      max-width: 1000px;
    }

    .card {
      background: linear-gradient(135deg, rgba(139, 0, 0, 0.3), rgba(0, 100, 0, 0.3));
      backdrop-filter: blur(10px);
      border: 3px solid #ffd700;
      border-radius: 20px;
      padding: 40px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
    }

    .card:hover {
      transform: translateY(-10px) scale(1.05);
      border-color: #ff0000;
      box-shadow: 0 20px 60px rgba(255, 0, 0, 0.6), 0 0 50px rgba(0, 255, 0, 0.4);
      background: linear-gradient(135deg, rgba(139, 0, 0, 0.5), rgba(0, 100, 0, 0.5));
    }

    .card-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
    }

    .card-title {
      font-size: 1.8rem;
      font-weight: bold;
    }

    /* Mini Leaderboard */
    .mini-leaderboard {
      background: linear-gradient(135deg, rgba(139, 0, 0, 0.4), rgba(0, 100, 0, 0.4));
      backdrop-filter: blur(10px);
      border: 3px solid #ffd700;
      border-radius: 20px;
      padding: 30px;
      max-width: 600px;
      margin: 0 auto 40px;
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
    }

    .mini-leaderboard-title {
      font-size: 2rem;
      font-weight: bold;
      text-align: center;
      margin-bottom: 20px;
      color: #ffd700;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
    }

    .mini-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      margin-bottom: 8px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      font-size: 0.95rem;
    }

    .mini-item.rank-1 {
      border-left: 3px solid #ffd700;
      background: rgba(255, 215, 0, 0.15);
    }

    .mini-item.rank-2 {
      border-left: 3px solid #c0c0c0;
      background: rgba(192, 192, 192, 0.15);
    }

    .mini-item.rank-3 {
      border-left: 3px solid #cd7f32;
      background: rgba(205, 127, 50, 0.15);
    }

    .expand-btn {
      width: 100%;
      padding: 12px;
      background: rgba(255, 215, 0, 0.2);
      border: 2px solid #ffd700;
      border-radius: 10px;
      color: #ffd700;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 10px;
    }

    .expand-btn:hover {
      background: rgba(255, 215, 0, 0.3);
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
    }

    /* Typing Test */
    .typing-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
    }

    .typing-box {
      background: rgba(30, 27, 75, 0.8);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(167, 139, 250, 0.3);
      border-radius: 20px;
      padding: 40px;
      max-width: 900px;
      width: 100%;
    }

    .sentence-display {
      background: rgba(15, 23, 42, 0.8);
      padding: 30px;
      border-radius: 15px;
      font-size: 1.8rem;
      line-height: 2.2;
      margin-bottom: 30px;
      font-family: 'Courier New', monospace;
      min-height: 120px;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }

    .char-correct { color: #10b981; }
    .char-incorrect { color: #ef4444; }
    .char-pending { color: #6b7280; }

    .typing-input {
      width: 100%;
      padding: 20px;
      font-size: 1.3rem;
      background: rgba(15, 23, 42, 0.8);
      border: 2px solid #a78bfa;
      border-radius: 15px;
      color: white;
      outline: none;
      font-family: 'Courier New', monospace;
      resize: none;

      direction: ltr;
      unicode-bidi: isolate;
      text-align: left;
    }

    .typing-input:focus {
      border-color: #ec4899;
      box-shadow: 0 0 20px rgba(236, 72, 153, 0.3);
    }

    .stats-bar {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      font-size: 1.2rem;
      color: #a78bfa;
    }

    .results-box {
      background: rgba(15, 23, 42, 0.9);
      padding: 40px;
      border-radius: 15px;
      text-align: center;
    }

    .wpm-display {
      font-size: 5rem;
      font-weight: bold;
      color: #ff0000;
      text-shadow: 0 0 40px rgba(255, 0, 0, 0.8), 0 0 20px rgba(0, 255, 0, 0.5);
      margin-bottom: 20px;
    }

    .accuracy-display {
      font-size: 2rem;
      color: #10b981;
      margin-bottom: 10px;
    }

    /* Click Test */
    .click-container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
    }

    .click-button {
      width: 300px;
      height: 300px;
      border-radius: 50%;
      background: linear-gradient(135deg, #ec4899, #8b5cf6);
      border: none;
      font-size: 3rem;
      font-weight: bold;
      color: white;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 20px 60px rgba(236, 72, 153, 0.5);
    }

    .click-button:hover {
      transform: scale(1.05);
    }

    .click-button:active {
      transform: scale(0.95);
    }

    .click-button.pulsing {
      animation: pulse 0.5s ease infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .click-count {
      font-size: 5rem;
      font-weight: bold;
      color: #ec4899;
      margin: 30px 0;
      text-shadow: 0 0 30px rgba(236, 72, 153, 0.6);
    }

    /* Leaderboard */
    .leaderboard-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
    }

    .leaderboard-box {
      background: rgba(30, 27, 75, 0.8);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(167, 139, 250, 0.3);
      border-radius: 20px;
      padding: 40px;
      max-width: 800px;
      width: 100%;
    }

    .leaderboard-title {
      font-size: 3rem;
      font-weight: bold;
      text-align: center;
      margin-bottom: 40px;
      color: #a78bfa;
    }

    .leaderboard-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      margin-bottom: 15px;
      background: rgba(15, 23, 42, 0.6);
      border-radius: 12px;
      border-left: 4px solid transparent;
      transition: all 0.3s ease;
    }

    .leaderboard-item:hover {
      background: rgba(15, 23, 42, 0.9);
      transform: translateX(5px);
    }

    .leaderboard-item.rank-1 {
      border-left-color: #fbbf24;
      background: rgba(251, 191, 36, 0.1);
    }

    .leaderboard-item.rank-2 {
      border-left-color: #9ca3af;
      background: rgba(156, 163, 175, 0.1);
    }

    .leaderboard-item.rank-3 {
      border-left-color: #f97316;
      background: rgba(249, 115, 22, 0.1);
    }

    .rank-number {
      font-size: 2rem;
      font-weight: bold;
      min-width: 60px;
    }

    .rank-1 .rank-number { color: #fbbf24; }
    .rank-2 .rank-number { color: #9ca3af; }
    .rank-3 .rank-number { color: #f97316; }

    .player-name {
      font-size: 1.3rem;
      flex-grow: 1;
      margin-left: 20px;
    }

    .player-stats {
      text-align: right;
    }

    .player-wpm {
      font-size: 1.5rem;
      font-weight: bold;
      color: #a78bfa;
    }

    .player-accuracy {
      font-size: 1rem;
      color: #6b7280;
    }

    /* Buttons */
    .btn {
      padding: 15px 40px;
      font-size: 1.2rem;
      font-weight: bold;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 20px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #ff0000, #00ff00);
      color: white;
      box-shadow: 0 10px 30px rgba(255, 0, 0, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 40px rgba(255, 0, 0, 0.6), 0 0 30px rgba(0, 255, 0, 0.5);
    }

    .btn-secondary {
      background: rgba(55, 65, 81, 0.8);
      color: white;
    }

    .btn-secondary:hover {
      background: rgba(75, 85, 99, 0.9);
    }

    .footer {
      text-align: center;
      margin-top: 60px;
      color: #6b7280;
      font-size: 0.9rem;
    }

    /* Loading */
    .loading {
      text-align: center;
      padding: 40px;
      font-size: 1.5rem;
      color: #a78bfa;
    }

    .spinner {
      display: inline-block;
      width: 50px;
      height: 50px;
      border: 4px solid rgba(167, 139, 250, 0.3);
      border-top-color: #a78bfa;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @media (max-width: 768px) {
      .title { font-size: 2.5rem; }
      .cards-grid { grid-template-columns: 1fr; }
      .sentence-display { font-size: 1.3rem; }
      .wpm-display { font-size: 3.5rem; }
      .click-button { width: 200px; height: 200px; font-size: 2rem; }
      .click-count { font-size: 3.5rem; }
    }
  </style>
</head>

<body>
<div class="lights">
  <div class="light"></div>
  <div class="light"></div>
  <div class="light"></div>
  <div class="light"></div>
  <div class="light"></div>
  <div class="light"></div>
  <div class="light"></div>
  <div class="light"></div>
  <div class="light"></div>
  <div class="light"></div>
  <div class="light"></div>
  <div class="light"></div>
  <div class="light"></div>
  <div class="light"></div>
  <div class="light"></div>
  <div class="light"></div>
  <div class="light"></div>
  <div class="light"></div>
  <div class="light"></div>
  <div class="light"></div>
</div>

<div id="app"></div>

<script>
/* ================= FIREBASE INIT ================= */
firebase.initializeApp({
  apiKey: "AIzaSyAv__llreM9IMHGkSSd7sfLESK-C5f8dwk",
  authDomain: "ltn-project-typing.firebaseapp.com",
  projectId: "ltn-project-typing"
});
const db = firebase.firestore();

/* ================= CHRISTMAS EFFECTS ================= */
function createSnowflakes() {
  const snowflakes = ['‚ùÑ', '‚ùÖ', '‚ùÜ', '‚úª', '‚úº', '‚ùâ'];
  for (let i = 0; i < 50; i++) {
    const snowflake = document.createElement('div');
    snowflake.className = 'snowflake';
    snowflake.textContent = snowflakes[Math.floor(Math.random() * snowflakes.length)];
    snowflake.style.left = Math.random() * 100 + '%';
    snowflake.style.animationDuration = (Math.random() * 3 + 5) + 's';
    snowflake.style.animationDelay = Math.random() * 5 + 's';
    snowflake.style.fontSize = (Math.random() * 10 + 10) + 'px';
    document.body.appendChild(snowflake);
  }
}

/* ================= SENTENCES ================= */
const SENTENCES = [
  "The quick brown fox jumps over the lazy dog.",
  "Typing fast requires accuracy before speed.",
  "Practice every day to improve your typing skill.",
  "Consistency is more important than talent.",
  "Small progress every day leads to big success.",
  "Accuracy matters more than raw speed.",
  "Focus on rhythm while typing sentences.",
  "Typing without looking builds muscle memory.",
  "Mistakes help you learn faster.",
  "Speed comes naturally after accuracy.",
  "The keyboard becomes easier with practice.",
  "Typing tests are fun ways to track progress.",
  "Do not rush focus on correct letters.",
  "Every mistake is a chance to improve.",
  "Your fingers learn faster than you think.",
  "Typing is a useful skill for school work.",
  "Fast typing saves time during homework.",
  "Coding becomes easier with fast typing.",
  "Stay calm while typing long sentences.",
  "Confidence improves typing speed.",
  "Long sentences require patience and focus.",
  "Typing is a mix of speed rhythm and accuracy.",
  "Practicing ten minutes daily is enough.",
  "Do not compare yourself to others.",
  "Progress matters more than rankings.",
  "Focus on clean inputs and correct spelling.",
  "Muscle memory builds over time naturally.",
  "Typing tests help improve concentration.",
  "Your speed increases as errors decrease.",
  "Enjoy the process of learning to type.",
  "Christmas time brings joy and happiness to all.",
  "Santa Claus delivers presents on Christmas Eve.",
  "Snowflakes fall gently on winter nights.",
  "Hot chocolate warms you up in cold weather.",
  "Family gatherings make holidays more special.",
];

/* ================= STATE ================= */
let mode = "menu";
let playerName = "";

// Typing
let currentSentence = "";
let userInput = "";
let startTime = null;
let isActive = false;
let isFinished = false;
let wpm = 0;
let accuracy = 100;
let errors = 0;
let typingTimer = null;

// Click
let clicks = 0;
let clickStart = null;
let clickRunning = false;
let clickTime = 10;
let clickTimer = null;

// Leaderboard
let leaderboardData = [];
let leaderboardLoading = false;
let showFullLeaderboard = false;

/* ================= HELPERS ================= */
function randomSentence() {
  currentSentence = SENTENCES[Math.floor(Math.random() * SENTENCES.length)];
}

function resetTyping() {
  userInput = "";
  startTime = null;
  isActive = false;
  isFinished = false;
  wpm = 0;
  accuracy = 100;
  errors = 0;
  if (typingTimer) clearInterval(typingTimer);
  randomSentence();
}

function getPlayerName() {
  if (!playerName) {
    const name = prompt("üéÑ Enter your name for the leaderboard:");
    if (name && name.trim()) {
      playerName = name.trim();
    } else {
      playerName = "Anonymous";
    }
  }
  return playerName;
}

/* ================= TYPING TEST ================= */
function sanitizeLTR(text) {
  return text.replace(/[\u200E\u200F\u202A-\u202E\u2066-\u2069]/g, "");
}
  
function handleTyping(e) {
  if (isFinished) return;
  
  if (!isActive && e.target.value.length > 0) {
    startTime = Date.now();
    isActive = true;
    
    typingTimer = setInterval(() => {
      render();
    }, 100);
  }
  
userInput = sanitizeLTR(e.target.value);
  
  if (userInput === currentSentence) {
    finishTyping();
  }
  
  render();
}

function finishTyping() {
  isFinished = true;
  isActive = false;
  if (typingTimer) clearInterval(typingTimer);

  const timeMin = (Date.now() - startTime) / 60000;
  const words = currentSentence.split(" ").length;
  wpm = Math.round(words / timeMin);

  errors = 0;
  for (let i = 0; i < userInput.length; i++) {
    if (userInput[i] !== currentSentence[i]) errors++;
  }

  accuracy = Math.round(((currentSentence.length - errors) / currentSentence.length) * 100);

  const name = getPlayerName();

  db.collection("leaderboard").add({
    name: name,
    wpm: wpm,
    accuracy: accuracy,
    timestamp: Date.now()
  }).then(() => {
    console.log("Score saved to leaderboard!");
    loadLeaderboard();
  }).catch(err => {
    console.error("Error saving to leaderboard:", err);
  });

  render();
}

/* ================= CLICK TEST ================= */
function startClickTest() {
  clicks = 0;
  clickRunning = true;
  clickStart = Date.now();
  
  clickTimer = setInterval(() => {
    const elapsed = (Date.now() - clickStart) / 1000;
    if (elapsed >= clickTime) {
      clickRunning = false;
      if (clickTimer) clearInterval(clickTimer);
    }
    render();
  }, 50);
  
  render();
}

function registerClick() {
  if (clickRunning) {
    clicks++;
  }
}

/* ================= LEADERBOARD ================= */
function loadLeaderboard() {
  leaderboardLoading = true;
  render();
  
  db.collection("leaderboard")
    .orderBy("wpm", "desc")
    .limit(20)
    .get()
    .then(snapshot => {
      leaderboardData = snapshot.docs.map(d => d.data());
      leaderboardLoading = false;
      render();
    })
    .catch(err => {
      console.error("Error loading leaderboard:", err);
      leaderboardData = [];
      leaderboardLoading = false;
      render();
    });
}

/* ================= RENDER ================= */
function render() {
  const app = document.getElementById("app");

  /* ===== MENU ===== */
  if (mode === "menu") {
    const topPlayers = leaderboardData.slice(0, 5);
    
    app.innerHTML = `
      <div class="menu-container">
        <h1 class="title">üéÑ Type Master Pro üéÑ</h1>
        
        ${!leaderboardLoading && topPlayers.length > 0 ? `
          <div class="mini-leaderboard">
            <div class="mini-leaderboard-title">üèÜ Top 5 Champions üèÜ</div>
            ${topPlayers.map((player, i) => `
              <div class="mini-item rank-${i + 1 <= 3 ? i + 1 : ''}">
                <div style="display: flex; align-items: center; gap: 10px;">
                  <span style="font-weight: bold; min-width: 30px;">#${i + 1}</span>
                  <span>${player.name}</span>
                </div>
                <div style="text-align: right;">
                  <div style="font-weight: bold; color: #ffd700;">${player.wpm} WPM</div>
                  <div style="font-size: 0.85rem; color: #9ca3af;">${player.accuracy}% acc</div>
                </div>
              </div>
            `).join("")}
            <button class="expand-btn" onclick="mode='leaderboard';render()">
              üìä View Full Leaderboard
            </button>
          </div>
        ` : leaderboardLoading ? `
          <div class="mini-leaderboard">
            <div class="loading">
              <div class="spinner"></div>
              <div style="margin-top: 10px; font-size: 1rem;">Loading champions...</div>
            </div>
          </div>
        ` : ''}
        
        <div class="cards-grid">
          <div class="card" onclick="mode='typing';resetTyping();render()">
            <div class="card-icon">‚å®Ô∏è</div>
            <div class="card-title">Typing Test</div>
            <p style="margin-top: 10px; color: #9ca3af;">Test your typing speed and accuracy</p>
          </div>

          <div class="card" onclick="mode='click';render()">
            <div class="card-icon">üñ±Ô∏è</div>
            <div class="card-title">Click Test</div>
            <p style="margin-top: 10px; color: #9ca3af;">How fast can you click?</p>
          </div>

          <div class="card" onclick="mode='leaderboard';render()">
            <div class="card-icon">üèÜ</div>
            <div class="card-title">Leaderboard</div>
            <p style="margin-top: 10px; color: #9ca3af;">See all top performers worldwide</p>
          </div>
        </div>

        <div class="footer">
          üéÖ Merry Christmas! ¬© 2025 Ltn Project ‚õÑ
        </div>
      </div>`;
    return;
  }

  /* ===== TYPING TEST ===== */
  if (mode === "typing") {
    const elapsed = isActive ? Math.floor((Date.now() - startTime) / 1000) : 0;
    const progress = Math.round((userInput.length / currentSentence.length) * 100);
    
    app.innerHTML = `
      <div class="typing-container">
        <div class="container">
          <div class="typing-box">
            <div class="sentence-display">
              ${currentSentence.split("").map((c, i) => {
                let className = "char-pending";
                if (i < userInput.length) {
                  className = userInput[i] === c ? "char-correct" : "char-incorrect";
                }
                return `<span class="${className}">${c === ' ' ? '&nbsp;' : c}</span>`;
              }).join("")}
            </div>

            ${!isFinished ? `
              <textarea id="typeInput" 
                class="typing-input" 
                placeholder="Start typing here..." 
                rows="4"
                oninput="handleTyping(event)"
                autofocus>${userInput}</textarea>
              
              ${isActive ? `
                <div class="stats-bar">
                  <div>‚è±Ô∏è Time: ${elapsed}s</div>
                  <div>üìä Progress: ${progress}%</div>
                  <div>‚ùå Errors: ${errors}</div>
                </div>
              ` : ''}
            ` : `
              <div class="results-box">
                <div class="wpm-display">${wpm} WPM</div>
                <div class="accuracy-display">‚úì ${accuracy}% Accuracy</div>
                <div style="color: #6b7280; margin-top: 10px;">Errors: ${errors}</div>
                <button class="btn btn-primary" onclick="resetTyping();render()">
                  üîÑ Try Again
                </button>
              </div>
            `}

            <button class="btn btn-secondary" onclick="mode='menu';render()">
              üîô Back to Menu
            </button>
          </div>
        </div>
      </div>`;
    
    if (!isFinished) {
      setTimeout(() => {
        const input = document.getElementById('typeInput');
        if (input) input.focus();
      }, 0);
    }
    return;
  }

  /* ===== CLICK TEST ===== */
  if (mode === "click") {
    const timeLeft = clickRunning ? Math.max(0, clickTime - (Date.now() - clickStart) / 1000) : clickTime;
    const cps = clicks > 0 && !clickRunning ? (clicks / clickTime).toFixed(2) : 0;
    
    app.innerHTML = `
      <div class="click-container">
        <h1 class="title" style="margin-bottom: 20px;">üñ±Ô∏è Click Speed Test</h1>
        
        ${clickRunning ? `
          <div style="font-size: 2rem; color: #a78bfa; margin-bottom: 20px;">
            ‚è±Ô∏è ${timeLeft.toFixed(1)}s
          </div>
        ` : ''}
        
        <div class="click-count">${clicks}</div>
        
        ${!clickRunning ? `
          <button class="btn btn-primary" onclick="startClickTest()" style="font-size: 1.5rem; padding: 20px 60px;">
            ‚ñ∂ Start ${clickTime}s Test
          </button>
          
          ${clicks > 0 ? `
            <div style="margin-top: 30px; font-size: 1.5rem;">
              <div style="color: #10b981;">Average: ${cps} clicks/sec</div>
            </div>
          ` : ''}
        ` : `
          <button class="click-button pulsing" onclick="registerClick()">
            CLICK!
          </button>
        `}

        <button class="btn btn-secondary" onclick="mode='menu';render()" style="margin-top: 40px;">
          üîô Back to Menu
        </button>
      </div>`;
    return;
  }

  /* ===== LEADERBOARD ===== */
  if (mode === "leaderboard") {
    app.innerHTML = `
      <div class="leaderboard-container">
        <div class="container">
          <div class="leaderboard-box">
            <h1 class="leaderboard-title">üèÜ Global Leaderboard</h1>

            ${leaderboardLoading ? `
              <div class="loading">
                <div class="spinner"></div>
                <div style="margin-top: 20px;">Loading scores...</div>
              </div>
            ` : leaderboardData.length > 0 ? `
              ${leaderboardData.map((player, i) => `
                <div class="leaderboard-item rank-${i + 1 <= 3 ? i + 1 : ''}">
                  <div class="rank-number">#${i + 1}</div>
                  <div class="player-name">${player.name}</div>
                  <div class="player-stats">
                    <div class="player-wpm">${player.wpm} WPM</div>
                    <div class="player-accuracy">${player.accuracy}% acc</div>
                  </div>
                </div>
              `).join("")}
            ` : `
              <div style="text-align: center; padding: 60px 20px; color: #6b7280;">
                <div style="font-size: 3rem; margin-bottom: 20px;">üéØ</div>
                <div style="font-size: 1.3rem;">No scores yet!</div>
                <div style="margin-top: 10px;">Be the first to set a record!</div>
              </div>
            `}

            <button class="btn btn-primary" onclick="mode='menu';render()" style="width: 100%;">
              üîô Back to Menu
            </button>
          </div>
        </div>
      </div>`;
  }
}

/* ================= INIT ================= */
createSnowflakes();
randomSentence();
loadLeaderboard();
render();
</script>
</body>
</html>
